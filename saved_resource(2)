var debug=(location.hash=='#debug');var Waveform=function(element,callback){if(element&&element.length>0&&!$(element).hasClass("rendered")){this.render(element,callback);return this;}else{return null;}};function isInt(n){return n%1===0;}
window.getDevicePixelRatio=function(){var ratio=1;if(window.screen.systemXDPI!==undefined&&window.screen.logicalXDPI!==undefined&&window.screen.systemXDPI>window.screen.logicalXDPI){ratio=window.screen.systemXDPI/window.screen.logicalXDPI;}
else if(window.devicePixelRatio!==undefined){ratio=window.devicePixelRatio;}
return ratio;};Waveform.prototype={canvas:null,ctx:null,width:3000,widthEstimated:0,aurora:null,height:100,color:'#ffffff',highlight:'#cb1606',align:'bottom',linear:false,animate:false,duration:1,easing:'swing',normalize:true,gradient:true,alpha:1,smooth:3,blocks:false,'data-url':null,artist_id:null,track_id:null,sampleData:[],position:0,prevPosition:-1,maxPeak:false,zero:128,pattern1:null,pattern2:null,callback:false,redraw:function(e){this.drawImage();},setDefaultValues:function(element,callback){var waveform=this;this.canvas=element;var cssColor=$(this.canvas).css("color");this.color=(cssColor!="")?cssColor:this.color;this.setAttrs(['width','height','data-url','data-track','id','color','highlight','align','animate','duration','easing','normalize','linear','smooth','position','gradient','blocks','aurora','alpha']);if(this.linear=="false")this.linear=false;if(this.normalize=="false")this.normalize=false;if(this.gradient=="false")this.gradient=false;if(this.blocks){this.blocks=this.blocks.split(',');this.blocks[0]=parseFloat(this.blocks[0]);this.blocks[1]=parseFloat(this.blocks[1]);this.blocks[2]=this.blocks[2]=="false"?false:true;}
pixelration=getDevicePixelRatio();if(pixelration==2){this.blocks[0]=parseFloat(this.blocks[0])*2;this.blocks[1]=parseFloat(this.blocks[1])*2;}
if(pixelration==3){this.blocks[0]=parseFloat(this.blocks[0])*3;this.blocks[1]=parseFloat(this.blocks[1])*3;}
this.smooth=parseInt(this.smooth);this.width=parseInt(this.width);this.height=parseInt(this.height);this.position=parseInt(this.position);this.ctx=$(this.canvas).get(0).getContext('2d');this.artist_id=+$(this.canvas).parents('li').data('artistid');this.track_id=+$(this.canvas).parents('li').data('trackid');this.callback=callback;this.loadSamples();},setAttrs:function(arr){var i=arr.length;while(i--){this[arr[i]]=this.attr(arr[i],this[arr[i]])}},attr:function(attr,defaultSetting){var attr=$(this.canvas).attr(attr);return(attr!=undefined)?attr:defaultSetting;},loadSamples:function(){var waveform=this;var url=waveform['data-url'];var data_track=waveform['data-track'];var data=null;var ext=url.substring(url.lastIndexOf('.'));if(debug)console.log(waveform.artist_id,waveform.track_id);if(waveform.artist_id>0&&waveform.track_id>0){var samples=new Image();samples.crossOrigin='anonymous';samples.onload=function(){if(debug)console.log('PNG gefunden!');new LogoMemory(this.src,function(){waveform.sampleData=this.samples;waveform.draw(function(){waveform.show();});});ext=null;removeLocal(url);}
samples.onerror=function(){try{if(ext=='.png'&&waveform.aurora&&!$(waveform.aurora).find('.aurora').length){new LogoMemory(url,function(){$(waveform.aurora).prepend($(new Aurora(this.colors)).fadeIn(2000));});}
data=getLocal(url);if(data!=""&&data!=null&&data!="null"){waveform.sampleData=data;waveform.draw(function(){waveform.show();});}else{ajx();}}catch(e){ajx();}
if(debug)console.log('PNG fÃ¼r Track '+waveform.track_id+' wird erstellt...');var converter=new Image();converter.crossOrigin='anonymous';converter.src='/saveDataAsImage.php?id='+waveform.track_id;}
samples.src='/_/cache/waveform_png/'+waveform.artist_id+'/'+waveform.track_id+'.png';}
if(ext=='.js'){var ajx=function(){if(data_track!=""){waveform.sampleData=jQuery.parseJSON(data_track);waveform.draw(function(){waveform.show();});}else{$.ajax({url:url,dataType:'json',async:false,cache:true,timeout:99999999999,success:function(data){if(data!=""&&data!=null&&data!="null"){waveform.sampleData=data;waveform.draw(function(){waveform.show();});}}});}}}else if(ext=='.png'){var ajx=function(){new LogoMemory(url,function(){waveform.sampleData=this.samples;waveform.draw(function(){waveform.show();});});}}},drawPeak:function(x){var v=this.linear?parseInt(this.sampleData[x]/(this.normalize?this.maxPeak:255)*this.height):Math.pow(this.height+this.zero,this.sampleData[x]/(this.normalize?this.maxPeak:255));if(this.linear)v=v>this.height+this.zero?this.height+this.zero:v-this.zero<=0?this.zero+1:v;var y=this.height-v;var p=this.linear?this.height-y*2:v-this.zero;var t=this.width/this.sampleData.length;var top,bottom;switch(this.align){case"bottom":top=this.linear?y*2:y+this.zero;bottom=this.height;break;case"top":top=0;bottom=this.linear?v-y:p;break;default:top=this.linear?y:(y+this.zero)/2;bottom=this.linear?v:this.height-top;break;}
var color=$.color.parse(this.color)
color.a=this.alpha;this.ctx.fillStyle=this.gradient?this.createGradient(color,0,top,0,bottom):'rgba('+color.r+','+color.g+','+color.b+','+color.a+')';if(v>1)this.ctx.fillRect(Math.ceil(x*t),top,Math.ceil(t),p);},drawPeaks:function(callback){var x=this.sampleData.length;while(x--){this.drawPeak(x)}
if(callback)callback();},drawImage:function(){var waveform=this;this.ctx.globalCompositeOperation='source-atop';if(this.pattern1){this.loadImage(this.pattern1,function(pattern){waveform.mapImage(pattern,0,0,waveform.position,waveform.height);if(waveform.pattern2){waveform.loadImage(waveform.pattern2,function(pattern){waveform.mapImage(pattern,waveform.position,0,waveform.width-waveform.position,waveform.height);});}else{waveform.mapColor(waveform.color,waveform.position,0,waveform.width-waveform.position,waveform.height);}});}else if(this.pattern2){this.mapColor(this.highlight,0,0,this.position,this.height);this.loadImage(this.pattern2,function(pattern){waveform.mapImage(pattern,waveform.position,0,waveform.width-waveform.position,waveform.height);});}else{this.mapColor(this.highlight,0,0,this.position,this.height);this.mapColor(this.color,this.position,0,this.width-this.position,this.height);}},mapColor:function(color,x,y,w,h){var colorParsed=$.color.parse(color);var colorDark=$.color.parse(color).scale('rgb',0.95);var gradient=this.ctx.createLinearGradient(0,((h/2)+10),0,h);gradient.addColorStop(0,color);gradient.addColorStop(1,colorDark);this.ctx.fillStyle=gradient;this.ctx.fillRect(x,y,w,h);},mapImage:function(img,x,y,w,h){this.ctx.fillStyle=this.ctx.createPattern(img,"repeat");this.ctx.fillRect(x,y,w,h);},loadImage:function(url,callback){var waveform=this;var showImage=function(e){var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var zoomX=waveform.width/$(waveform.canvas).width();var zoomY=waveform.height/$(waveform.canvas).height();canvas.width=e.target.width*zoomX;canvas.height=e.target.height*zoomY;ctx.drawImage(e.target,0,0,canvas.width,canvas.height);window[btoa(url)]=canvas;callback(canvas);};if(window[btoa(url)]==undefined){var image=new Image();image.crossOrigin='anonymous';image.onload=showImage;image.src=url;}else{callback(window[btoa(url)]);}},draw:function(callback){var i=this.smooth;while(i--){this.smoothData(i);};if(this.blocks&&this.blocks.length==3)this.addGaps(this.blocks[0],this.blocks[1],this.blocks[2]);this.maxPeak=Math.max.apply(null,this.sampleData);this.zero=this.linear?0:Math.pow(this.height,128/this.maxPeak);if(this.color.substring(this.color.lastIndexOf('.')).match('.(png|jpg)')){this.pattern2=this.color;this.color='rgba(255,255,255,'+parseFloat(this.alpha)+')';}
if(this.highlight.substring(this.highlight.lastIndexOf('.')).match('.(png|jpg)')){this.pattern1=this.highlight;this.highlight='rgba(255,255,255,'+parseFloat(this.alpha)+')';}
this.ctx.globalCompositeOperation='source-over';this.clear();this.drawPeaks(callback);this.drawImage();},smoothData:function(_intDurchlauf){var i=this.sampleData.length;while(i--){if(this.sampleData[i-1]){this.sampleData[i]=this.sampleData[i-1]=(this.sampleData[i-1]+this.sampleData[i])/2;}
var intValPercent=(this.sampleData[i]*100)/255;if(intValPercent<=55){if(_intDurchlauf>1){this.sampleData[i]=this.sampleData[i]+Math.round(this.sampleData[i]/20);}else{this.sampleData[i]=this.sampleData[i]+Math.round(this.sampleData[i]/40);}}else if((intValPercent>55)&&(intValPercent<=75)){this.sampleData[i]=this.sampleData[i]+Math.round(this.sampleData[i]/12);}else if((intValPercent>=75)&&(intValPercent<=90)){this.sampleData[i]=this.sampleData[i]+Math.round(this.sampleData[i]/20);}
if(this.sampleData[i]>255){this.sampleData[i]=255;}}},addGaps:function(a,b,c){intwidth=$(this.canvas).width();var intPixelRatio=getDevicePixelRatio();if((($(this.canvas).width()||this.widthEstimated)*intPixelRatio)<this.width){var zoom=this.width/(($(this.canvas).width()||this.widthEstimated)*intPixelRatio);}else{var zoom=(($(this.canvas).width()||this.widthEstimated)*intPixelRatio)/this.width;}
a*=zoom,b*=zoom;if(a>0){var i=this.sampleData.length;var peaks=[];while(i--){if(b>0){if(i%(a+b)<b){if(peaks.length&&c){var sum=avg=0,k=peaks.length;for(j in peaks)sum+=peaks[j];avg=Math.round(sum/k)||0;while(k--)this.sampleData[i+k+1]=avg;peaks=[];}
this.sampleData[i]=0;}else{if(c)peaks.push(this.sampleData[i]);}}else if(c){peaks.push(this.sampleData[i]);if(!Math.round(i%a)&&peaks.length){var sum=avg=0,k=peaks.length;for(j in peaks)sum+=peaks[j];avg=Math.round(sum/k)||0;while(k--)this.sampleData[i+k+1]=avg;peaks=[];}}}}},clear:function(){this.ctx.clearRect(0,0,this.width,this.height);},show:function(){var waveform=this;if(this.animate!="false"){$(this.canvas).css({'opacity':1});$(this.canvas).removeAttr('style');$(this.canvas).removeClass("queued").addClass("rendered");if(this.callback)window.requestAnimFrame(this.callback);}else{$(this.canvas).css({'opacity':1});$(this.canvas).removeAttr('style');$(this.canvas).removeClass("queued").addClass("rendered");if(this.callback)window.requestAnimFrame(this.callback);}
if(location.hash=="#custom"&&$(this.canvas).parents("li").find(".fa-cogs").length==0){$(this.canvas).parents("li").first().prepend($('<i onclick="showWaveformControls($(this).parent().find(\'.waveform\'))" class="fa fa-cogs" style="margin-top: 25px;opacity: 0.2;z-index: 1000;display: block;cursor: pointer;position: absolute;right: 10px;"></i>'));}},createGradient:function(rgb,x1,t,x2,b){var objGradient=this.ctx.createLinearGradient(x1,t,x2,b);var transparent="rgba("+rgb.r+","+rgb.g+","+rgb.b+",0)";switch(this.align){case"bottom":if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){objGradient.addColorStop(0,rgb);objGradient.addColorStop(1,rgb);}else{objGradient.addColorStop(0,transparent);objGradient.addColorStop(0.2,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",1)");objGradient.addColorStop(1,rgb);}
break;case"top":objGradient.addColorStop(0,rgb);objGradient.addColorStop(0.8,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",1)");objGradient.addColorStop(1,transparent);break;default:objGradient.addColorStop(0,transparent);objGradient.addColorStop(0.13,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.7)");objGradient.addColorStop(0.28,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.9)");objGradient.addColorStop(0.35,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.96)");objGradient.addColorStop(0.5,rgb);objGradient.addColorStop(0.65,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.96)");objGradient.addColorStop(0.72,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.9)");objGradient.addColorStop(0.87,"rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.7)");objGradient.addColorStop(1,transparent);break;}
return objGradient;},setPosition:function(e,redraw){var track=findTrack(parseInt($(e.target).data("trackid")));this.prevPosition=this.position;this.position=track?parseInt(track.position/pagePlayer.getDurationEstimate(track)*this.width):0;if(this.position>=this.width)this.position=0;$(this.canvas).attr('position',this.position);if(redraw)this.redraw(e);},render:function(element,callback){var _this=this;if(!$.color)require("/_/javascripts/jquery.colorhelpers.js");$(element).addClass("queued");$(element).css({'opacity':0});var container=$(element).parents('li').first();if(container.length){container.on("soundposition",function(e){_this.setPosition(e,true)});container.on("soundstop",function(e){_this.setPosition(e,true)});this.setPosition({target:container},false);}
this.setDefaultValues(element,callback);}}
function require(src){$('<script>').attr({type:'text/javascript',src:src}).prependTo($('head'));}
var LogoMemory=function(src,callback){this.src=src;this.callback=callback;this.init();return this;}
LogoMemory.prototype={src:null,mask:'/_/images/logo_mask.png',colors:[],samples:[],callback:null,init:function(){var _this=this;var data=new Image();data.crossOrigin='anonymous';data.onload=function(e){var data=e.target;var mask=new Image();mask.crossOrigin='anonymous';mask.onload=function(e){var mask=e.target;_this.parse(data,mask);if(_this.callback)_this.callback();}
mask.src=_this.mask;}
data.src=this.src;},data:function(img){var canvas=document.createElement('canvas');canvas.width=img.naturalWidth;canvas.height=img.naturalHeight;var ctx=canvas.getContext('2d');ctx.crossOrigin='anonymous';ctx.drawImage(img,0,0);return ctx.getImageData(0,0,canvas.width,canvas.height).data;},parse:function(data,mask){this.colors=[];this.samples=[];var data=this.data(data);var mask=this.data(mask);var i=mask.length/4;while(i--){if(mask[i*4]==0){}else{if(this.samples.length<3000){this.samples.push(mask[i*4]-data[i*4],mask[i*4+1]-data[i*4+1],mask[i*4+2]-data[i*4+2]);}}}}}
var Aurora=function(colors){this.colors=colors;return this.init();}
Aurora.prototype={canvas:document.createElement('canvas'),width:1000,height:223,colors:[],dna:null,dnaSize:5,init:function(){return this.buildAurora();},blur:function(data){var i=data.length;while(i--)if(data[i+4]!=undefined&&data[i-4]!=undefined)data[i]=data[i+4]=data[i-4]=(data[i+4]+data[i-4]+data[i])/3;return data;},buildAurora:function(){var ctx=this.canvas.getContext('2d');this.canvas.width=this.width;this.canvas.height=this.height;this.canvas.className="aurora";ctx.drawImage(this.buildDNA(),0,0,this.dna.width,this.dna.height,0,this.canvas.height-this.dnaSize,this.canvas.width,this.dnaSize);ctx.drawImage(this.buildDNA(80),0,0,this.dna.width,this.dna.height,0,0,this.canvas.width,this.canvas.height-this.dnaSize);var objGradient=ctx.createLinearGradient(0,0,0,this.canvas.height-this.dnaSize);objGradient.addColorStop(0,'rgba(0,0,0,0.9)');objGradient.addColorStop(1,'rgba(0,0,0,0.1)');ctx.fillStyle=objGradient;ctx.fillRect(0,0,this.canvas.width,this.canvas.height-this.dnaSize);ctx.fillRect(0,0,this.canvas.width,this.canvas.height-this.dnaSize);return this.canvas;},buildDNA:function(blur){this.dna=document.createElement('canvas');this.dna.width=this.colors.length/4;this.dna.height=1;var ctx=this.dna.getContext('2d');var pixel=ctx.getImageData(0,0,this.dna.width,this.dna.height);while(blur--){this.colors=this.blur(this.colors);}
try{pixel.data.set(this.colors);}catch(e){var i=pixel.data.length;while(i--)pixel.data[i]=this.colors[i];}
ctx.putImageData(pixel,0,0);return this.dna;}}
function getLocal(key){var data=false;try{data=JSON.parse(localStorage.getItem(key));return data;}catch(e){return false;}}
function storeLocal(key,data){try{localStorage.setItem(key,JSON.stringify(data));return true;}catch(e){return false;}}
function removeLocal(key){try{localStorage.removeItem(key);return true;}catch(e){return false;}}
function dropLocal(){try{localStorage.clear();return true;}catch(e){return false;}}
$.fn.isOnScreen=function(){var win=$(window);var viewport={top:win.scrollTop(),left:win.scrollLeft()};viewport.right=viewport.left+win.width();viewport.bottom=viewport.top+win.height();var bounds=this.offset();bounds.right=bounds.left+this.outerWidth();bounds.bottom=bounds.top+this.outerHeight();return(!(viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom));};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,10000/60);};})();window.setCustomInterval=function(callback){window.requestAnimFrame(function(){setCustomInterval(callback)});callback();}
isScrolling=false;var scrolltimer;$(window).bind('scroll',function(){isScrolling=true;clearTimeout(scrolltimer);scrolltimer=setTimeout(refreshScrolling,50);});var refreshScrolling=function(){isScrolling=false;};function renderWaveform(canvas,callback){transformPlayer();new Waveform(canvas,callback);}
function renderWaveforms(){if(!isScrolling&&!$("canvas.waveform:animated").length){var canvas=$('canvas.waveform:not(.rendered, .queued):visible').get().reverse();var i=canvas.length;if(i>0){transformPlayer();}
while(i--){var nextElement=$(canvas[i]);if(nextElement&&nextElement.isOnScreen()&&$(nextElement).is(":visible")&&$(nextElement).parent().width()>0){new Waveform($(nextElement),renderWaveforms);break;}}}}
function transformPlayer(){try{var snd=false;if(snd=findTrack()){if(!$('#'+snd.sID).length){var currentPlayer=$(snd._data.oLI);var currentWaveform=$(currentPlayer).find('.img_container > canvas');var currentHighlight=$(snd._data.oPosition).find('.img > canvas');var newPlayer=$('li[data-id='+$(currentPlayer).attr('data-id')+']:not(.sm2_playing, .sm2_paused)');var newWaveform=$(newPlayer).find('.img_container > canvas');var newHighlight=$(newPlayer).find('.position > .img > canvas');var id=$(newPlayer).attr('id');var classNames=$(newPlayer).attr('class');if(newPlayer.length>0&&currentPlayer!=newPlayer){$(newWaveform).attr({position:$(currentWaveform).attr('position'),animate:false}).removeClass('rendered');$(currentWaveform).remove();$(currentHighlight).remove();$(newWaveform).appendTo($(currentPlayer).find('.img_container'));$(newHighlight).appendTo($(currentPlayer).find('.position > .img'));$(currentPlayer).attr({'id':id,'class':classNames}).addClass((snd.paused)?'sm2_paused':'sm2_playing').insertAfter($(newPlayer));$(newPlayer).remove();}}}}catch(e){}}
function isAnimationReady(callback){document.addEventListener("webkitAnimationStart",callback,false);document.addEventListener("mozAnimationStart",callback,false);document.addEventListener("oAnimationStart",callback,false);document.addEventListener("MSAnimationStart",callback,false);document.addEventListener("animationstart",callback,false);}
$(document).ready(function(){playlist=new Playlist(false);if(location.hash=='#debug'){$('<link/>').attr({rel:'stylesheet',type:'text/css',href:'/_/javascripts/generateWaveform.css'}).prependTo('head');isAnimationReady(function(e){if(e.animationName=='waveReady'){animationCount++;if($('canvas.waveform:not(.rendered, .queued)').length==animationCount){window.requestAnimFrame(renderWaveforms);animationCount=0;}}});$(window).resize(function(){$('.waveform[blocks]').each(function(){var canvas=$(this);window.requestAnimFrame(function(){renderWaveform(canvas);});})});}else{if(!window.waveWatcher)window.waveWatcher=window.setCustomInterval(renderWaveforms);$(window).resize(function(){$('.waveform[blocks]').removeClass('rendered')});}});function updateValues(element){var target=element||$('.waveform').first();var options={animate:false,blocks:$('#block').val()+','+$('#gap').val()+','+$('#average').is(':checked'),linear:$('#linear').is(':checked'),normalize:$('#normalize').is(':checked'),smooth:$('#smooth').val(),align:$('#align').val(),gradient:$('#gradient').is(':checked'),color:(pattern=/^url\((['"]?)(.*)\1\)$/.exec($('#color_colorSelector div').css('background-image')))?pattern[2]:$('#color_colorSelector div').css('background-color'),highlight:(pattern=/^url\((['"]?)(.*)\1\)$/.exec($('#highlight_colorSelector div').css('background-image')))?pattern[2]:$('#highlight_colorSelector div').css('background-color'),alpha:$('#alpha').val()}
renderWaveform(target.attr(options).removeClass('rendered'));}
function switchBgImage(element){var url=prompt('URL eingeben...',(pattern=/^url\((['"]?)(.*)\1\)$/.exec($(element).css('background-image')))?pattern[2]:'http://');if(url&&url.match('^http://.*\.(jpg|png)$')){$(element).css({'background':'url('+url+') no-repeat center center','background-size':'cover'});updateValues();}}
function showWaveformControls(el){var element=el||$('.waveform').first();$('.waveform_controls').remove();$('<style>.colorSelector_item {position: relative;width: 36px;height: 36px;background: url(/_/images/colorpicker/select.png);}.colorSelector_item div {position: absolute;top: 3px;left: 3px;width: 30px;height: 30px;background-size:cover!important}.waveform_controls{position: fixed; width: 300px; border-radius: 10px;background-color: rgba(255, 255, 255, 0.88);top: 70px;right: 220px;z-index: 10000;box-shadow: 0px 0px 8px rgba(0,0,0,0.7);padding: 20px;}.waveform_controls table{width:100%;margin:0;padding: 10px 0}.waveform_controls td{padding:0 10px}.row{pointer-events:none}</style>').appendTo('head');var options={blocks:$(element).attr('blocks')||Waveform.prototype.blocks,linear:$(element).attr('linear')||Waveform.prototype.linear,normalize:$(element).attr('normalize')||Waveform.prototype.normalize,smooth:$(element).attr('smooth')||Waveform.prototype.smooth,align:$(element).attr('align')||Waveform.prototype.align,gradient:$(element).attr('gradient')||Waveform.prototype.gradient,color:$(element).attr('color')&&$(element).attr('color').match('.*\.(jpg|png)$')?'url('+$(element).attr('color')+')':$(element).attr('color')||Waveform.prototype.color,highlight:$(element).attr('highlight')&&$(element).attr('highlight').match('.*\.(jpg|png)$')?'url('+$(element).attr('highlight')+')':$(element).attr('highlight')||Waveform.prototype.highlight,alpha:$(element).attr('alpha')||Waveform.prototype.alpha}
$('<div class="waveform_controls"><i onclick="hideWaveformControls()" class="fa fa-remove" style="float:right;cursor:pointer;color:#333"></i><h4>Waveform Controls</h4><table><tr><td><label>Color</label><div id="color_colorSelector" class="colorSelector_item"><div style="background:'+options.color+'"></div></div></td><td><label>Highlight</label><div id="highlight_colorSelector" class="colorSelector_item"><div style="background:'+options.highlight+'"></div></div></td><td><label>Gradient</label><input type="checkbox" id="gradient" onchange="updateValues()"'+(options.gradient?' checked="checked"':'')+'><label>Linear</label><input type="checkbox" id="linear" onchange="updateValues()"'+(options.linear?' checked="checked"':'')+'></td></tr><tr><td><button onclick="switchBgImage($(\'#color_colorSelector div\'))">Image...</button></td><td><button onclick="switchBgImage($(\'#highlight_colorSelector div\'))">Image...</button></td><td><label>Normalize</label><input type="checkbox" id="normalize" onchange="updateValues()"'+(options.normalize?'checked="checked"':'')+'></td></tr><tr><td colspan=3><label>Smooth</label><input type="range" min="0" max="50" value="'+options.smooth+'" id="smooth" onchange="updateValues()"></td></tr><tr><td colspan=2><label>Block Size</label><input type="range" min="0" max="20" value="0" step="1" id="block" onchange="updateValues()"></td><td><label>Digitize</label><input type="checkbox" id="average" checked="checked" onchange="updateValues()"></td></tr><tr><td colspan=3><label>Gap Size</label><input type="range" min="0" max="20" value="0" step="1" id="gap" onchange="updateValues()"></td></tr><tr><td colspan=3><label>Alpha</label><input type="range" min="0" max="1" value="'+options.alpha+'" step="0.1" id="alpha" onchange="updateValues()"></td></tr><tr><td colspan=3><label>Align</label><select id="align" onchange="updateValues()"><option value="top">Top</option><option value="center">Center</option><option value="bottom" selected="selected">Bottom</option></select></td></tr></table></div>').prependTo($(element).parents("li").first()).fadeIn(500);$('#color_colorSelector, #highlight_colorSelector').ColorPicker({color:'#ffffff',onShow:function(colpkr){$(colpkr).fadeIn(500);return false},onHide:function(colpkr){$(colpkr).fadeOut(500);return false},onChange:function(hsb,hex,rgb){$($(this).data('colorpicker').el).find('div').css('background','#'+hex);updateValues();}});}
function hideWaveformControls(){$('.waveform_controls').fadeOut(500).remove()}
var animationCount=0;var renderVisibleCanvasObjects=function(){}
var findTrack=function(id){if(soundManager){var i=soundManager.soundIDs.length;while(i--){var snd=soundManager.getSoundById(soundManager.soundIDs[i]);if(id){if(snd._data.oLI.dataset.trackid==id){return snd;break;}}else{if(snd.playState>0){return snd;break;}}}}
return false;}
function findPaused(){if(soundManager){var i=soundManager.soundIDs.length;while(i--){var snd=soundManager.getSoundById(soundManager.soundIDs[i]);if(snd.paused){return snd;break;}}}
return false;}
try{var play=function(id){soundManager.pauseAll();var track,sndObj;if(id>0){track=$('li[data-trackid='+id+']>a');sndObj=findPaused();if(track.length){pagePlayer.handleClick({target:track[0]});}else if(sndObj&&findTrack(id)==sndObj){pagePlayer.handleClick({target:sndObj._data.oLink});}else{$.post("/track_ajax_player.php",{id:id}).success(function(track){track=$(track);var a=track.find("a");a.attr({'href':a.attr('data-mp3')});$('.playlist').first().prepend($('<div/>').css({'display':'none'}).append(track));pagePlayer.handleClick({target:$('li[data-trackid='+id+']>a')[0]});});}}else{if($('li.sm2_paused').length){pagePlayer.handleClick({target:$('li.sm2_paused > a')[0]});}else if(sndObj=findPaused()){pagePlayer.handleClick({target:sndObj._data.oLink});}else if(playlist&&playlist.tracks.length>0){var trackIndex=$("#play_queue").find("li.active").index();if(trackIndex>0){id=playlist.tracks[trackIndex];}else{id=playlist.tracks[0];var els=$("#play_queue").find("li");els.removeClass("active");$(els[0]).addClass("active");}
play(id);}else{var els=$("#play_queue").find("li");els.removeClass("active");track=$('.playlist a')[0];id=$(track).parent('li').attr('data-trackid');pagePlayer.handleClick({target:track});}}
setTimeout(function(){playNext(id)},1000);},pause=soundManager.pauseAll,stop=soundManager.stopAll;}catch(e){}
var playNext=function(id){}
var Playlist=function(tracks){this.import=function(){try{tracks=[];this.id=this.id?this.id:this.allIDs()[0]||this.createUniqueID();return localStorage[this.id]!=undefined?JSON.parse(atob(localStorage[this.id])):[];}catch(e){console.log('localStorage not supported');}},this.update=function(){try{if(this.id)localStorage.setItem(this.id,btoa(JSON.stringify(this.tracks)));}catch(e){console.log('localStorage not supported');}
this.updateInfo();},this.delete=function(){try{localStorage.removeItem(this.id);}catch(e){console.log('localStorage not supported');}},this.deleteAll=function(){var IDs=this.allIDs();try{for(id in IDs){localStorage.removeItem(IDs[id]);}}catch(e){console.log('localStorage not supported');}},this.firstLoad=true,this.add=function(track){this.tracks.push(track);this.update();return this.tracks;},this.remove=function(track){this.tracks.splice(track,1);this.update();return this.tracks;},this.clear=function(){this.tracks=[];$("#play_queue").find("li").remove();this.update();},this.adopt=function(tracks){this.clear();this.tracks=tracks;this.firstLoad=true;this.update();},this.grab=function(){var tracks=[];$('.playlist > li').each(function(idx,el){tracks.push($(this).attr('data-trackid'))});playlist.adopt(tracks);},this.loop=true,this.shuffle=function(){var item=0;var oldtracks=this.tracks.slice();this.tracks.sort(function(a,b){var r=Math.random()-0.5;if(r>0){var plI=$("li[data-playlist-id]");$(plI[item]).insertAfter($(plI[++item]))}
return r;});this.tracks=jQuery("#play_queue").find("ul").sortable("toArray",{attribute:"data-playlist-id"});if(oldtracks==this.tracks){this.shuffle();}else{this.update();return this.tracks;}},this.createUniqueID=function(){return(typeof tracks=='object'||tracks!==false)?'PLY'+btoa(Math.random()).replace(/=/g,''):tracks;},this.allIDs=function(){var IDs=[];try{var db=localStorage;for(id in db){if(id.substring(0,3)=="PLY")IDs.push(id);}}catch(e){console.log('localStorage not supported');}
return IDs;},this.info=[],this.stringify=function(){return JSON.stringify(this.info);},this.updateInfo=function(){},this.ready=function(){return this.tracks.length==this.info.length;},this.play=function(idx){var track=idx>-1?idx:0;return play(this.tracks[track]);},this.init=(function(playlist){playlist.id=playlist.createUniqueID(),playlist.tracks=(typeof tracks=='object')?tracks:playlist.import();playlist.update();})(this);return this;}
var playlist,waveforms=[];var Slideshow=function(el,obj){var _this=this;$(document).ready(function(){if(typeof flux!='function')require("/_/javascripts/flux.min.js");_this.init($(el),obj);});}
Slideshow.prototype={element:null,parent:null,trackid:null,trackel:null,track:null,player:null,imagesLoaded:0,imageAliases:[],data:{},init:function(el,obj){var _this=this;this.element=$('<div/>',{id:'slideshow'}).css({position:'absolute',width:'100%',height:el.outerHeight(),'z-index':-1,top:el.offset().top,left:el.offset().left,clip:'rect(0,auto,'+el.outerHeight()+'px,auto)'}).prependTo(el);this.parent=el;this.trackel=$('.playlist li:first-child').first();if(this.trackel.length){this.trackid=this.trackel.data('trackid');this.data=obj;this.currentImage=this.data[0].url;this.create();$(window).resize(function(){if(_this.element.children().length){if(_this.player&&_this.player.images.length){var idx=_this.player.currentImageIndex;var url=_this.player.images[idx]?_this.findImageAlias(_this.player.images[idx].src):_this.findImageAlias(_this.player.images[0].src);_this.element.css({'background-image':'url('+url+')','background-size':'cover','background-position':'center center'});}
_this.remove();}
window.clearTimeout(_this.eventTimer);_this.eventTimer=window.setTimeout(function(){$(window).trigger('resizeend');},500);});$(window).on('resizeend',function(){_this.create();});}},hasEvents:false,addEvents:function(){var _this=this;if(!this.hasEvents){this.trackel.on("soundstart",function(){_this.setPositions()});this.trackel.on("soundmousedown",function(){_this.showCurrentImage()});this.hasEvents=true;}},setPositions:function(){if(!this.track)this.track=findTrack(this.trackid);for(i in this.data){var position=this.data[i].position;var url=this.data[i].url;var transition=this.data[i].transition;this.setPosition(position,url,transition);}},setPosition:function(position,url,transition){var _this=this;this.track.onPosition(position,function(){if(_this.element.length)_this.showImage(url,_this.trackel.hasClass('sm2_playing')?transition:false);});},showImage:function(url,transition){var idx=this.getIndexFromURL(url);this.currentImage=url;this.player.showImage(idx,transition);},getIndexFromURL:function(url){if(this.player&&this.player.images.length){var i=this.player.images.length;while(i--){var target=this.findImageAlias(this.player.images[i].src).replace(location.protocol+'//'+location.host,'');if(target==url){return i;break;}}}
return 0;},currentImage:null,create:function(){var _this=this;this.insertImages(this.loadCallback);},loadCallback:function(){var _this=this;this.imagesLoaded++;if(this.imagesLoaded==this.data.length){this.player=new flux.slider(this.element,{autoplay:false,pagination:false});this.addEvents();this.showCurrentImage();}},showCurrentImage:function(){if(this.track){for(i in this.data){if(this.data[i].position<=this.track.position){this.currentImage=this.data[i].url;}else{break;}}}else{this.currentImage=this.data[0].url;}
this.showImage(this.currentImage,false);},insertImages:function(callback){this.imagesLoaded=0;this.imageAliases=[];for(i in this.data){this.mapImgResponsive(this.data[i].url,callback);}},mapImgResponsive:function(url,callback){var div=$('<div/>',{width:this.element.width(),height:this.element.height()});div.css({'background-image':'url('+url+')','background-position':'center center','background-size':'cover'});this.getImageFromBackground(div,callback);},findImageAlias:function(img){var i=this.imageAliases.length;while(i--){var alias=this.imageAliases[i];if(alias[1]==img)return alias[0];}
return false;},getImageFromBackground:function(el,callback){var _this=this;var imgClone=new Image();imgClone.crossOrigin='anonymous';var w=imgClone.width=el.width();var h=imgClone.height=el.height();var x=w/100*parseInt(el.css('background-position-x'));var y=h/100*parseInt(el.css('background-position-y'));imgClone.src=/^url\((['"]?)(.*)\1\)$/.exec(el.css('background-image'))[2];imgClone.onload=function(){var bg_w=this.naturalWidth;var bg_h=this.naturalHeight;if(w<h){this.height=h;this.width=this.height/bg_h*bg_w;if(this.width<w){this.width=w;this.height=this.width/bg_w*bg_h;}}else{this.width=w;this.height=this.width/bg_w*bg_h;if(this.height<h){this.height=h;this.width=this.height/bg_h*bg_w;}}
x-=this.width/2;y-=this.height/2;var canvas=_this.convertImageToCanvas(imgClone,x,y,w,h);var img=_this.convertCanvasToImage(canvas).src;_this.imageAliases.push([imgClone.src,img]);$('<img/>').attr({src:img}).css({position:'absolute',opacity:0}).appendTo(_this.element);if(typeof callback=='function')callback.apply(_this);}},convertImageToCanvas:function(image,x,y,w,h){var canvas=document.createElement("canvas");canvas.width=w;canvas.height=h;canvas.getContext("2d").drawImage(image,x,y,image.width,image.height);return canvas;},convertCanvasToImage:function(canvas){var image=new Image();image.src=canvas.toDataURL("image/png");return image;},remove:function(){this.element.children().remove();if(this.player){this.player.stop();this.player=null;}},eventTimer:window.setTimeout(function(){},0)}
var sampledata=[{position:0,url:'/_/images/abstract_lights.jpg',transition:false},{position:4000,url:'/_/cache/images/user/1600/000a5f65a86926c5f1ad069077d36d99_w1600.jpg',transition:'bars'},{position:8000,url:'/_/cache/images/user/1600/e03f0ffc9383f11c75234871d3db2d85_w1600.jpg',transition:'slide'},{position:12000,url:'/_/cache/images/user/1600/7b01a96957b9fe0ceada0433aaadb357_w1600.jpg',transition:'blocks'},{position:16000,url:'/_/cache/images/user/1600/891721064e48b702b8fe07b05da16dbc_w1600.jpg',transition:'concentric'},{position:20000,url:'/_/cache/images/user/1600/0023d0c7a3e4ddad1461f2a8e7788a6c_w1600.jpg',transition:'bars'},{position:24000,url:'/_/cache/images/user/1600/0043727c75b5e495eb9c46985d40b404_w1600.jpg',transition:'warp'},{position:28000,url:'/_/cache/images/user/1600/006375ec5beba6ccdebfd4c6eb3a7cd6_w1600.jpg',transition:'blocks2'},{position:32000,url:'/_/cache/images/user/1600/00897cc776dcaffcc265d299e6f06cec_w1600.jpg',transition:'zip'},{position:36000,url:'/_/cache/images/user/1600/00abbf8733f4abbf4f92f52d3f2f9ed6_w1600.jpg',transition:'random'},{position:40000,url:'/_/cache/images/user/1600/00cc845117466f848f3d739c8fa93b6a_w1600.jpg',transition:'random'},{position:44000,url:'/_/cache/images/user/1600/00ffa6aaaf4e19b6a0fb9b4a194f0204_w1600.jpg',transition:'random'},{position:48000,url:'/_/cache/images/user/1600/014ff6eaab71be7268b5f1f813155703_w1600.jpg',transition:'random'},{position:52000,url:'/_/cache/images/user/1600/018167af37af427a0eb6dd029afe5c6b_w1600.jpg',transition:'random'},{position:60000,url:'/_/cache/images/user/1600/018a9ddd95ca38bc358d486b849e9d8d_w1600.jpg',transition:'random'}];;jQuery.ajaxSetup({cache:false});var l18nTimeVorNow="now";var l18nTimeVorPrefix="";var l18nTimeAmPrefix="";var l18nTimeVorSuffixM=" min ago";var l18nTimeVorSuffixH=" h ago";var l18nTimeVorSuffixT=" T ago";var timerAktiv=window.setInterval("calcTime()",1000);function calcTime(){jQuery(".now").removeClass("now");jQuery(".new").removeClass("new");jQuery(".focused").removeClass("focused");intLastInit=Math.round(+new Date()/1000);jQuery(".playlist").find("li").each(function(){var intItemTime=parseInt(jQuery(this).attr("data-time"),10);if(intItemTime>0){var intTimeDiff=Math.round((intLastInit-intItemTime)/60);if(intTimeDiff<60){var strTimeAgo=l18nTimeVorPrefix+intTimeDiff+l18nTimeVorSuffixM;if(intTimeDiff<=10){jQuery(this).addClass("new");}
if(intTimeDiff<60){jQuery(this).addClass("focused");}}else if((intTimeDiff<1440)&&(intTimeDiff>=60)){var strTimeAgo=l18nTimeVorPrefix+Math.round(intTimeDiff/60)+l18nTimeVorSuffixH;}else{var date=new Date(intItemTime*1000);var Std=date.getHours();var StdAusgabe=((Std<10)?"0"+Std:Std);var Min=date.getMinutes();var MinAusgabe=((Min<10)?"0"+Min:Min);var strTimeAgo=l18nTimeAmPrefix+("0"+date.getDate()).slice(-2)+"."+("0"+(date.getMonth()+1)).slice(-2)+"."+(date.getFullYear());}
if(intTimeDiff==0){var strTimeAgo=l18nTimeVorNow;jQuery(this).addClass("now");}
jQuery(this).find(".time_ago").html(strTimeAgo);}});jQuery(".calctime").each(function(){var intItemTime=parseInt(jQuery(this).attr("data-time"),10);if(intItemTime>0){var intTimeDiff=Math.round((intLastInit-intItemTime)/60);if(intTimeDiff<60){var strTimeAgo=l18nTimeVorPrefix+intTimeDiff+l18nTimeVorSuffixM;if(intTimeDiff<=10){jQuery(this).parents("li").addClass("new");}
if(intTimeDiff<60){jQuery(this).parents("li").addClass("focused");}}else if((intTimeDiff<1440)&&(intTimeDiff>=60)){var strTimeAgo=l18nTimeVorPrefix+Math.round(intTimeDiff/60)+l18nTimeVorSuffixH;}else{var date=new Date(intItemTime*1000);var Std=date.getHours();var StdAusgabe=((Std<10)?"0"+Std:Std);var Min=date.getMinutes();var MinAusgabe=((Min<10)?"0"+Min:Min);var strTimeAgo=l18nTimeAmPrefix+("0"+date.getDate()).slice(-2)+"."+("0"+(date.getMonth()+1)).slice(-2)+"."+(date.getFullYear());}
if(intTimeDiff==0){var strTimeAgo=l18nTimeVorNow;jQuery(this).parents("li").addClass("now");}
jQuery(this).html(strTimeAgo);}});}
function countPlay(){window.setTimeout(function(){if(typeof intSource=="undefined"){intSource=0;}
var objElement=jQuery(".sm2_playing");var intPlaysCurrentCount=parseInt(objElement.find(".plays_count").text(),10);objElement.find(".plays_count").html("<i class=\"fa fa-play-circle\"></i> "+(intPlaysCurrentCount+1));var intTrackId=objElement.attr("data-id")
jQuery(".track_"+intTrackId).each(function(){objElement=jQuery(this);var intPlaysCurrentCount=parseInt(objElement.find(".plays_count").first().data("count"),10);var intPlaysNewCount=intPlaysCurrentCount+1;objElement.find(".infobits").find(".plays_count").html("<i class=\"fa fa-play-circle-o\"></i> "+accounting.formatNumber(intPlaysNewCount,0,".",","));});},250);}
function countTime(){}
function countLike(_intTrackId){var date=new Date();jQuery(".track_"+_intTrackId).each(function(){objElement=jQuery(this);var intLikesCurrentCount=parseInt(objElement.find(".likes_count").first().text(),10);if(!objElement.find(".like_fct").hasClass("active")){objElement.find(".like_fct").addClass("active").find("i").removeClass("fa-heart-o").addClass("fa-heart");objElement.find(".likes_count").html("<i class=\"fa fa-heart-o\"></i> "+(intLikesCurrentCount+1));countShare(_intTrackId);}else{objElement.find(".like_fct").removeClass("active").find("i").addClass("fa-heart-o").removeClass("fa-heart");objElement.find(".likes_count").html("<i class=\"fa fa-heart-o\"></i> "+(intLikesCurrentCount-1));}});jQuery("body").append('<img width="1" height="1" src="/trackimgcnt.php?trackid='+_intTrackId+'&action=likes&time='+date.getTime()+'" />');}
function reFeed(_intTrackId){jQuery(".track_"+_intTrackId).each(function(){objElement=jQuery(this);var intRefeedCurrentCount=parseInt(objElement.find(".refeeds_count").first().text(),10);var date=new Date();if(!objElement.find(".refeed_fct").hasClass("active")){objElement.find(".refeed_fct").addClass("active");objElement.find(".download_not_payed").addClass("hidden");objElement.find(".download_payed").removeClass("hidden");objElement.find(".refeeds_count").html("<i class=\"fa fa-retweet\"></i> "+(intRefeedCurrentCount+1));}else{objElement.find(".refeed_fct").removeClass("active");objElement.find(".download_not_payed").removeClass("hidden");objElement.find(".download_payed").addClass("hidden");objElement.find(".refeeds_count").html("<i class=\"fa fa-retweet\"></i> "+(intRefeedCurrentCount-1));}});jQuery("body").append('<img width="1" height="1" src="/trackimgcnt.php?trackid='+_intTrackId+'&action=refeed&time='+date.getTime()+'" />');}
jQuery(".sm2_paused .controls, .sm2_playing .controls").live('mouseover',function(e){var deviceAgent=navigator.userAgent.toLowerCase();var agentID=deviceAgent.match(/(iphone|ipod|ipad)/);objElement=jQuery(this);if(!agentID){jQuery("div.marker").remove();var offset=jQuery(this).offset();var left=e.pageX-offset.left;objElement.append('<div class="marker"></div>');jQuery('div.marker').css("left",left+"px").show();}});jQuery(".sm2_paused .controls, .sm2_playing .controls").live('mouseout',function(e){jQuery("div.marker").remove();});jQuery(".sm2_paused .controls, .sm2_playing .controls").live('mousemove',function(e){var offset=jQuery(this).offset();var left=e.pageX-offset.left-2;jQuery("div.marker").css("left",left+"px");});function calculateWidth(){}
function countShare(_intTrackId){jQuery.fancybox.showLoading();jQuery.ajax({type:'POST',cache:false,url:'/track_ajax_share.php',data:"version=v2&trackid="+_intTrackId,success:function(data){$.fancybox(data);}});}
function followUser(_intUserId){jQuery("#user_fct_follow").find("span").html("un");jQuery(".user_fct_follow").find("span").html("un");jQuery("#user_fct_follow_head").find("span").html("un");jQuery.ajax({type:'POST',cache:false,url:'/user_ajax_function.php',data:"userid="+_intUserId+"&action=follow",success:function(data){if(data=="FOLLOWED"){jQuery("#user_fct_follow").find("span").html("un");jQuery(".user_fct_follow").find("span").html("un");jQuery("#user_fct_follow_head").find("span").html("un");}else{jQuery("#user_fct_follow").find("span").html("");jQuery(".user_fct_follow").find("span").html("");jQuery("#user_fct_follow_head").find("span").html("");}}});}
function loadInfobits(){}
/*!
 * accounting.js v0.4.1, copyright 2014 Open Exchange Rates, MIT license, http://openexchangerates.github.io/accounting.js
 */
(function(p,z){function q(a){return!!(""===a||a&&a.charCodeAt&&a.substr)}function m(a){return u?u(a):"[object Array]"===v.call(a)}function r(a){return"[object Object]"===v.call(a)}function s(a,b){var d,a=a||{},b=b||{};for(d in b)b.hasOwnProperty(d)&&null==a[d]&&(a[d]=b[d]);return a}function j(a,b,d){var c=[],e,h;if(!a)return c;if(w&&a.map===w)return a.map(b,d);for(e=0,h=a.length;e<h;e++)c[e]=b.call(d,a[e],e,a);return c}function n(a,b){a=Math.round(Math.abs(a));return isNaN(a)?b:a}function x(a){var b=c.settings.currency.format;"function"===typeof a&&(a=a());return q(a)&&a.match("%v")?{pos:a,neg:a.replace("-","").replace("%v","-%v"),zero:a}:!a||!a.pos||!a.pos.match("%v")?!q(b)?b:c.settings.currency.format={pos:b,neg:b.replace("%v","-%v"),zero:b}:a}var c={version:"0.4.1",settings:{currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}}},w=Array.prototype.map,u=Array.isArray,v=Object.prototype.toString,o=c.unformat=c.parse=function(a,b){if(m(a))return j(a,function(a){return o(a,b)});a=a||0;if("number"===typeof a)return a;var b=b||".",c=RegExp("[^0-9-"+b+"]",["g"]),c=parseFloat((""+a).replace(/\((.*)\)/,"-$1").replace(c,"").replace(b,"."));return!isNaN(c)?c:0},y=c.toFixed=function(a,b){var b=n(b,c.settings.number.precision),d=Math.pow(10,b);return(Math.round(c.unformat(a)*d)/d).toFixed(b)},t=c.formatNumber=c.format=function(a,b,d,i){if(m(a))return j(a,function(a){return t(a,b,d,i)});var a=o(a),e=s(r(b)?b:{precision:b,thousand:d,decimal:i},c.settings.number),h=n(e.precision),f=0>a?"-":"",g=parseInt(y(Math.abs(a||0),h),10)+"",l=3<g.length?g.length%3:0;return f+(l?g.substr(0,l)+e.thousand:"")+g.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+e.thousand)+(h?e.decimal+y(Math.abs(a),h).split(".")[1]:"")},A=c.formatMoney=function(a,b,d,i,e,h){if(m(a))return j(a,function(a){return A(a,b,d,i,e,h)});var a=o(a),f=s(r(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=x(f.format);return(0<a?g.pos:0>a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",t(Math.abs(a),n(f.precision),f.thousand,f.decimal))};c.formatColumn=function(a,b,d,i,e,h){if(!a)return[];var f=s(r(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=x(f.format),l=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,k=0,a=j(a,function(a){if(m(a))return c.formatColumn(a,f);a=o(a);a=(0<a?g.pos:0>a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",t(Math.abs(a),n(f.precision),f.thousand,f.decimal));if(a.length>k)k=a.length;return a});return j(a,function(a){return q(a)&&a.length<k?l?a.replace(f.symbol,f.symbol+Array(k-a.length+1).join(" ")):Array(k-a.length+1).join(" ")+a:a})};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)exports=module.exports=c;exports.accounting=c}else"function"===typeof define&&define.amd?define([],function(){return c}):(c.noConflict=function(a){return function(){p.accounting=a;c.noConflict=z;return c}}(p.accounting),p.accounting=c)})(this);;;(function($,window,undefined){'use strict';var $doc=$(document),Modernizr=window.Modernizr;$(document).ready(function(){$.fn.foundationTooltips?$doc.foundationTooltips():null;});})(jQuery,this);